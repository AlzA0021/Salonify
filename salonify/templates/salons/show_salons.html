{% extends 'main_template.html' %}
{% load render_partial %}
{% load static %}
{% load cache %}

{% block head %}
  <link rel="stylesheet" href="{% static 'css/salons.css' %}">
  {# Vendor CSS Ù…Ø®ØµÙˆØµ Ù‡Ù…ÛŒÙ† ØµÙØ­Ù‡ #}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css">
{% endblock head %}

{% block title %}Ø³Ø§Ù„Ù† Ù‡Ø§{% endblock %}

{# Ø¨Ø±Ø§ÛŒ Ù„ÙˆØ¯ Ù…Ø§Ú˜ÙˆÙ„ ØµÙØ­Ù‡ Ø§Ø² app.js #}
{% block body_attrs %}data-page="salons"{% endblock %}

{% block content %}
<div class="salons-user-dashboard">
  <div class="salons-profile-greeting">
    <h2>Ø³Ù„Ø§Ù…ØŒ {{ user.name }}</h2>
  </div>
</div>

{# ğŸ†• Ø¨Ø®Ø´ Ø±Ø²Ø±Ùˆ Ù…Ø¬Ø¯Ø¯ #}
{% if book_again_orders %}
<section class="salons-slider-section book-again-section">
  <div class="section-header">
    <h3>Ø±Ø²Ø±Ùˆ Ù…Ø¬Ø¯Ø¯</h3>
    <p class="section-subtitle">Ø¢Ø®Ø±ÛŒÙ† Ø³Ø§Ù„Ù†â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¯Ø± Ø¢Ù†â€ŒÙ‡Ø§ Ø®Ø¯Ù…Ø§Øª Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯</p>
  </div>
  
  <div class="swiper-container book-again-swiper">
    <div class="swiper-wrapper">
      {% for order in book_again_orders %}
        <div class="swiper-slide book-again-swiper-slide">
          {% include "salons/partials/book_again_card.html" %}
        </div>
      {% endfor %}
    </div>
    
    {# Navigation buttons Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¨Ø®Ø´ #}
    {% comment %} <div class="swiper-button-next book-again-next"></div>
    <div class="swiper-button-prev book-again-prev"></div> {% endcomment %}
  </div>
</section>
{% endif %}

{# Ø¨Ø®Ø´ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ #}
{% if favorits_salons %}
<section class="salons-slider-section">
  <h3>Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</h3>
  <div class="swiper-container salons-recent-swiper">
    <div class="swiper-wrapper">
      {% for salon in favorits_salons %}
        <div class="swiper-slide salons-swiper-slide">
          {% include "csf/partials/favorits_salon_card.html" %}
        </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

{# Ø¨Ø®Ø´ Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø§Ø²Ø¯ÛŒØ¯Ù‡Ø§ #}
{% if last_visited_salons %}
<section class="salons-slider-section">
  <h3>Ø§Ø®ÛŒØ±Ø§Ù‹ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø´Ø¯Ù‡</h3>
  <div class="swiper-container salons-recent-swiper">
    <div class="swiper-wrapper">
      {% for salon in last_visited_salons %}
        <div class="swiper-slide salons-swiper-slide">
          {% include "salons/partials/salon_card.html" %}
        </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

{% cache 600 top_salons_list %}
  {# Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ†â€ŒÙ‡Ø§ #}
  <section class="salons-slider-section">
    <h3>Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ†</h3>
    <div class="swiper-container salons-recent-swiper">
      <div class="swiper-wrapper">
        {% for salon in recent_salons %}
          <div class="swiper-slide salons-swiper-slide">
            {% include "salons/partials/salon_card.html" %}
          </div>
        {% endfor %}
      </div>
    </div>
  </section>
  
  {# Ø¨Ø®Ø´ Ø¨Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§ #}
  <section class="salons-slider-section">
    <h3>Ø¨Ø±ØªØ±ÛŒÙ†</h3>
    <div class="swiper-container salons-top-swiper">
      <div class="swiper-wrapper">
        {% for salon in top_salons %}
          <div class="swiper-slide salons-swiper-slide">
            {% include "salons/partials/salon_card.html" %}
          </div>
        {% endfor %}
      </div>
    </div>
  </section>
  
  {% render_partial "services:categories" %}
{% endcache %}

{% endblock content %}

{% block js %}
  {# Vendor JS Ù…Ø®ØµÙˆØµ Ù‡Ù…ÛŒÙ† ØµÙØ­Ù‡ (Swiper) #}
  <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
  
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    // ğŸ†• Swiper Ø¨Ø±Ø§ÛŒ Ø¨Ø®Ø´ Ø±Ø²Ø±Ùˆ Ù…Ø¬Ø¯Ø¯
    const bookAgainSwiper = new Swiper('.book-again-swiper', {
      slidesPerView: 1,
      spaceBetween: 16,
      navigation: {
        nextEl: '.book-again-next',
        prevEl: '.book-again-prev',
      },
      breakpoints: {
        576: {
          slidesPerView: 1.2,
        },
        768: {
          slidesPerView: 2,
        },
        992: {
          slidesPerView: 2.5,
        },
        1200: {
          slidesPerView: 3,
        }
      }
    });
    
    // Swiper Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯
    const swipers = document.querySelectorAll('.salons-recent-swiper, .salons-top-swiper');
    swipers.forEach(swiperEl => {
      new Swiper(swiperEl, {
        slidesPerView: 1.2,
        spaceBetween: 16,
        breakpoints: {
          576: {
            slidesPerView: 2,
          },
          768: {
            slidesPerView: 3,
          },
          992: {
            slidesPerView: 4,
          },
          1200: {
            slidesPerView: 5,
          }
        }
      });
    });

    // ğŸ†• Event handler Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ø±Ø²Ø±Ùˆ Ù…Ø¬Ø¯Ø¯
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('btn-book-again')) {
        const orderId = e.target.dataset.orderId;
        
        // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ØµÙØ­Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ù‚Ø±Ø§Ø± Ù…Ù„Ø§Ù‚Ø§Øª
        const appointmentUrl = `orders/reservation_detail/${orderId}/`;
        window.location.href = appointmentUrl;
      }
    });
  });
  </script>
{% endblock js %}

<style>
/* ğŸ†• Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø®Ø´ Ø±Ø²Ø±Ùˆ Ù…Ø¬Ø¯Ø¯ */
.book-again-section {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 24px;
  color: white;
}

.book-again-section .section-header h3 {
  color: white;
  margin-bottom: 4px;
}

.book-again-section .section-subtitle {
  color: rgba(255,255,255,0.8);
  font-size: 14px;
  margin: 0 0 16px 0;
}

.book-again-swiper-slide {
  height: auto;
  display: flex;
}

.book-again-swiper-slide .book-again-card {
  width: 100%;
  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
}

/* Navigation buttons Ø¨Ø±Ø§ÛŒ Ø±Ø²Ø±Ùˆ Ù…Ø¬Ø¯Ø¯ */
.book-again-next,
.book-again-prev {
  color: white;
  background: rgba(255,255,255,0.2);
  border-radius: 50%;
  width: 40px;
  height: 40px;
}

.book-again-next:hover,
.book-again-prev:hover {
  background: rgba(255,255,255,0.3);
}

.book-again-next::after,
.book-again-prev::after {
  font-size: 16px;
  font-weight: 600;
}
</style>